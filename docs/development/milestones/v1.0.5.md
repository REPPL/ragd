# Milestone: v1.0.5 - Configuration Exposure

Expose all hidden/hardcoded configurations to end users for full customisation.

## Goal

Make ragd fully configurable by exposing all previously hardcoded parameters that affect user results. Users should be able to customise prompts, thresholds, and algorithm parameters without code changes.

## Theme

**"Your RAG, Your Way"** - Full control over every aspect of the system.

## Use Cases Addressed

| Use Case | Description | Status |
|----------|-------------|--------|
| Prompt Customisation | Custom prompts for specific domains | ✅ Complete |
| Threshold Tuning | Adjust quality thresholds for use case | ✅ Complete |
| Algorithm Tuning | Fine-tune search and scoring parameters | ✅ Complete |

## Features Included

### Core Features

| Feature | Description | Status |
|---------|-------------|--------|
| Config Schema Extension | New Pydantic models for all parameters | ✅ Complete |
| Prompt Template System | File and inline prompt customisation | ✅ Complete |
| Agentic Parameters | CRAG/Self-RAG thresholds and temperatures | ✅ Complete |
| Search Tuning | BM25, RRF, position decay parameters | ✅ Complete |
| Processing Parameters | Token encoding, truncation settings | ✅ Complete |
| Hardware Thresholds | Configurable tier classification | ✅ Complete |

### CLI Extensions

| Feature | Description | Status |
|---------|-------------|--------|
| `ragd prompts` commands | list, export, show prompt templates | ✅ Complete |
| `--max-tokens` flag | Override max tokens for ask/chat | ✅ Complete |
| Config wizard extensions | New menu sections for all parameters | ✅ Complete |

### Documentation

| Feature | Description | Status |
|---------|-------------|--------|
| Config reference update | All new parameters documented | ✅ Complete |
| Prompt customisation guide | How to customise prompts | ✅ Complete |

## New Configuration Sections

### Agentic Parameters (`agentic_params`)

- `relevance_threshold`: Minimum relevance score (CRAG)
- `faithfulness_threshold`: Minimum faithfulness score (Self-RAG)
- `excellent_threshold`, `good_threshold`, `poor_threshold`: Quality bands
- Per-operation LLM parameters (temperature, max_tokens)
- Confidence calculation weights

### Search Tuning (`search_tuning`)

- `bm25_normalisation_divisor`: BM25 score normalisation
- `rrf_fetch_multiplier`: Reciprocal rank fusion parameter
- `position_decay_factor`: Score decay by position

### Processing (`processing`)

- `context_truncation_chars`: Max context for evaluation
- `chars_per_token_estimate`: Token estimation
- `token_encoding`: tiktoken encoding name

### Hardware Thresholds (`hardware_thresholds`)

- `minimal_max_memory_gb`: Threshold for MINIMAL tier
- `standard_max_memory_gb`: Threshold for STANDARD tier
- `high_max_memory_gb`: Threshold for HIGH tier

### Prompt Templates

- `rag_prompts`: Answer, summarise, compare, chat, refine
- `agentic_prompts`: relevance_eval, query_rewrite, faithfulness_eval
- `metadata_prompts`: summary, classification, context
- `evaluation_prompts`: faithfulness, answer_relevancy

## Files Modified

### Config System
- `src/ragd/config.py` - New Pydantic models

### Prompt System
- `src/ragd/prompts/__init__.py` - Exports
- `src/ragd/prompts/loader.py` - Prompt loading logic
- `src/ragd/prompts/defaults.py` - Default prompt definitions

### Consuming Code
- `src/ragd/chat/agentic.py` - Uses config for all parameters
- `src/ragd/chat/prompts.py` - File-based prompt loading
- `src/ragd/llm/metadata.py` - Config for temperatures, tokens
- `src/ragd/llm/context.py` - Config for context generation
- `src/ragd/search/hybrid.py` - Search tuning parameters
- `src/ragd/evaluation/metrics.py` - Evaluation prompts
- `src/ragd/hardware.py` - Hardware thresholds
- `src/ragd/ingestion/chunker.py` - Token encoding
- `src/ragd/text/html_clean.py` - Boilerplate patterns

### CLI
- `src/ragd/cli.py` - New prompts commands, max-tokens flag
- `src/ragd/ui/cli/commands/chat.py` - max_tokens parameter
- `src/ragd/ui/cli/config_wizard.py` - New wizard sections

### Documentation
- `docs/reference/config.example.yaml` - Full config reference
- `docs/guides/customising-prompts.md` - Prompt customisation guide

## Dependencies

- **v1.0.0** - Stable base required

## Success Criteria

- [x] All hardcoded parameters exposed in config
- [x] Prompt templates customisable via files
- [x] CLI commands for prompt management
- [x] Config wizard extended with new sections
- [x] Documentation updated
- [x] Backwards compatible (all defaults match previous hardcoded values)

## Backwards Compatibility

All changes are backwards compatible:
- Config schema version remains at 1 (purely additive)
- All new fields have defaults matching previous hardcoded values
- Existing configs continue working without modification

## Draft Release Notes

### ragd v1.0.5 - Configuration Exposure

**Your RAG, Your Way.**

Full control over every aspect of ragd's behaviour through configuration.

**What's New:**

- **Prompt Customisation** - Edit any prompt template to match your domain
  ```bash
  ragd prompts export  # Export templates for editing
  ragd prompts list --status  # See customisation status
  ```

- **Agentic RAG Tuning** - Fine-tune CRAG and Self-RAG thresholds
  ```yaml
  agentic_params:
    relevance_threshold: 0.6
    faithfulness_threshold: 0.7
  ```

- **Search Algorithm Tuning** - Control hybrid search behaviour
  ```yaml
  search_tuning:
    bm25_normalisation_divisor: 10.0
    rrf_fetch_multiplier: 3
  ```

- **CLI Enhancements**
  - `ragd prompts list/export/show` commands
  - `--max-tokens` flag for ask and chat commands
  - Extended config wizard with new sections

**Getting Started:**

```bash
# Export prompts for customisation
ragd prompts export

# Edit ~/.ragd/prompts/rag/answer.txt

# Configure via wizard
ragd config --interactive
```

**What's Next:**

- v1.1.0: Knowledge Graph CLI
- v1.2.0: Onboarding Experience

---

## Related Documentation

- [v1.0.0 - Performance & Polish](./v1.0.0.md) - Prerequisite milestone
- [Configuration Reference](../../reference/config.example.yaml) - Full config options
- [Customising Prompts Guide](../../guides/customising-prompts.md) - Prompt customisation
- [CLI Reference](../../reference/cli-reference.md) - Command documentation

---

**Status**: Released
