# Milestone: v0.3.2 - Tag Provenance

Schema enhancement to track tag origins and prepare for auto-tagging features.

## Goal

Extend the tag storage schema to track **provenance metadata** for each tag: source (manual/auto), confidence score, creation timestamp, and creator. This backward-compatible schema change prepares the foundation for F-061 (Auto-Tag Suggestions) and enables differentiation between user-defined and system-generated tags.

## Theme

**"Know Your Tags"** - Track where tags come from.

## Use Cases Addressed

| Use Case | Description | Status |
|----------|-------------|--------|
| Tag Origin Tracking | Know if a tag was added manually or auto-generated | ðŸ“‹ Planned |
| Auto-Tag Review | Identify unconfirmed auto-tags for review | ðŸ“‹ Planned |
| Quality Metrics | Track auto-tag accuracy over time | ðŸ“‹ Planned |
| Bulk Tag Management | Remove all auto-tags without affecting manual ones | ðŸ“‹ Planned |

## Features Included

| Feature | Description | Status |
|---------|-------------|--------|
| [F-064](../features/planned/F-064-tag-provenance.md) | Tag Provenance Schema | ðŸ“‹ Planned |

## Dependencies

- **v0.3.1** - Current release (schema v2.1)

## Scope

This is a **minimal patch release** focused on schema preparation:

### In Scope
- `TagEntry` dataclass with provenance fields
- Schema migration (v2.1 â†’ v2.2)
- Backward-compatible deserialisation
- `--provenance` flag for `ragd tag list`
- `--source` filter for tag commands

### Out of Scope (Deferred to v0.7.0)
- Auto-tag generation (F-061)
- Tag library management (F-062)
- Smart collections (F-063)
- WebUI integration

## Technical Changes

### Schema v2.2

```python
@dataclass
class TagEntry:
    """A tag with provenance tracking."""

    name: str
    source: Literal["manual", "legacy", "auto-keybert", "auto-llm", "auto-ner", "imported"] = "manual"
    confidence: float | None = None  # 0.0-1.0 for auto-generated
    created_at: datetime = field(default_factory=datetime.now)
    created_by: str | None = None  # User ID or model name
```

### Migration Strategy

1. **Automatic migration:** On first access, convert string tags to `TagEntry(source="legacy")`
2. **No data loss:** All existing tags preserved
3. **Backward compatible:** `tag_names` property returns simple string list

## Success Criteria

- [ ] Schema version bumped to 2.2
- [ ] Existing tags migrate to `source: "legacy"`
- [ ] New manual tags have `source: "manual"`
- [ ] `ragd tag list --provenance` shows source info
- [ ] `ragd tag list --source auto` filters by source
- [ ] All existing tests pass
- [ ] No breaking changes to external API
- [ ] Documentation updated

## Draft Release Notes

### ragd v0.3.2 - Tag Provenance

**Know your tags.**

This patch release adds provenance tracking to tags, preparing for intelligent auto-tagging in future releases.

**What's New:**

- **Tag Provenance** - Each tag now tracks its origin (manual, auto-generated, imported)
- **Source Filtering** - Filter tags by source with `--source manual` or `--source auto`
- **Provenance Display** - View tag origins with `--provenance` flag
- **Schema v2.2** - Backward-compatible schema upgrade

**Getting Started:**

```bash
# Upgrade (automatic schema migration)
pip install --upgrade ragd

# View tags with provenance info
ragd tag list doc-123 --provenance
# finance       [manual]
# quarterly     [legacy]    # Migrated from v0.3.1

# Filter by source
ragd tag list doc-123 --source manual

# Check schema version
ragd status
# Schema: v2.2
```

**What's Next:**

- v0.4.0 brings multi-modal support (vision embeddings, image queries)
- v0.7.0 will add auto-tag suggestions using this provenance foundation

---

## Related Documentation

- [v0.3.0 - Advanced Search & CLI](./v0.3.0.md) - Parent milestone
- [F-064: Tag Provenance](../features/planned/F-064-tag-provenance.md) - Feature specification
- [State-of-the-Art Tagging](../research/state-of-the-art-tagging.md) - Research background
- [ADR-0023: Metadata Schema Evolution](../decisions/adrs/0023-metadata-schema-evolution.md) - Migration strategy

---

**Status**: Planned
